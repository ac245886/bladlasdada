<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>C:\PapaLouie\Gameria</title>
<script src="https://unpkg.com/@ruffle-rs/ruffle"></script>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    background: #000;
    color: #e5e5e5;
    font-family: Consolas, "Lucida Console", monospace;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

#cmd {
    width: 980px;
    background: #000;
    border: 2px solid #888;
    box-shadow: 0 0 0 2px #222;
}

#titlebar {
    background: #1a1a1a;
    color: #fff;
    padding: 6px 10px;
    font-size: 14px;
    border-bottom: 2px solid #555;
}

#content {
    padding: 15px;
    font-size: 14px;
    line-height: 1.4;
}

.prompt {
    color: #cfcfcf;
    margin-bottom: 6px;
}
.prompt span { color: #9cdcfe; }

select, button, input[type="file"] {
    background: #000;
    color: #e5e5e5;
    border: 1px solid #777;
    font-family: inherit;
    font-size: 14px;
    padding: 3px;
}
button {
    padding: 3px 10px;
    cursor: pointer;
}
button:hover {
    background: #111;
}

#player-container {
    margin-top: 12px;
    width: 940px;
    height: 560px;
    background: #000;
    border: 1px solid #555;
    display: flex;
    justify-content: center;
    align-items: center;
}

#player-container ruffle-player {
    width: 100%;
    height: 100%;
}

#footer {
    margin-top: 10px;
    color: #777;
    font-size: 12px;
}
#footer a {
    color: #9cdcfe;
    text-decoration: none;
}
</style>
</head>

<body>

<div id="cmd">
    <div id="titlebar">
        C:\Windows\System32\cmd.exe â€” Papa Louie Gameria Library
    </div>

    <div id="content">

        <div class="prompt" id="windowsLine"></div>
        <div class="prompt" id="copyrightLine"></div>
        <br>
        <div class="prompt" id="systemInfo"></div>

        <div class="prompt">
            <span>C:\PapaLouie></span> select_gameria
            <select id="swfSelect">
                <option>Loading...</option>
            </select>
            <button id="loadBtn">RUN</button>
            <button id="downloadBtn">DOWNLOAD</button>
        </div>

        <div class="prompt">
            <span>C:\PapaLouie></span> import_swf
            <input type="file" id="swfFile" accept=".swf">
            <button id="importBtn">LOAD</button>
        </div>

        <div id="player-container"></div>

        <div id="footer">
            Ruffle Emulator | SWFs from
            <a href="https://archive.org/search?query=creator%3A%22Flipline+Studios%22" target="_blank">
                Archive.org
            </a>
        </div>

    </div>
</div>

<script>
/* ================= SYSTEM INFO ================= */

function getSystemInfo() {
    const ua = navigator.userAgent;
    const platform = navigator.platform || "";
    const lang = navigator.language || "en-US";

    let os = "Unknown OS";
    let version = "";
    let arch = /64/.test(platform) ? "x64" : "x86";

    if (/Android/.test(ua)) {
        os = "Android";
        version = ua.match(/Android\s([\d.]+)/)?.[1] || "";
    } else if (/CrOS/.test(ua)) {
        os = "ChromeOS";
    } else if (/iPhone|iPad|iPod/.test(ua)) {
        os = "iOS";
        version = ua.match(/OS (\d+_\d+)/)?.[1]?.replace("_", ".") || "";
        arch = "ARM";
    } else if (/Windows NT/.test(ua)) {
        os = screen.width >= 1920 ? "Windows 11" : "Windows 10";
        version = "10.0";
    } else if (/Mac OS X/.test(ua)) {
        os = "macOS";
        version = ua.match(/Mac OS X (\d+[_\d]+)/)?.[1]?.replace(/_/g, ".") || "";
        arch = "ARM/x64";
    } else if (/Linux/.test(ua)) {
        os = "Linux";
    }

    let browser = "Unknown Browser";
    let browserVersion = "";

    if (/Edg/.test(ua)) {
        browser = "Edge";
        browserVersion = ua.match(/Edg\/([\d.]+)/)?.[1];
    } else if (navigator.brave) {
        browser = "Brave";
    } else if (/OPR/.test(ua)) {
        browser = "Opera";
        browserVersion = ua.match(/OPR\/([\d.]+)/)?.[1];
    } else if (/SamsungBrowser/.test(ua)) {
        browser = "Samsung Internet";
        browserVersion = ua.match(/SamsungBrowser\/([\d.]+)/)?.[1];
    } else if (/Chrome/.test(ua)) {
        browser = "Chrome";
        browserVersion = ua.match(/Chrome\/([\d.]+)/)?.[1];
    } else if (/Firefox/.test(ua)) {
        browser = "Firefox";
        browserVersion = ua.match(/Firefox\/([\d.]+)/)?.[1];
    } else if (/Safari/.test(ua)) {
        browser = "Safari";
    }

    document.getElementById("windowsLine").textContent =
        `Microsoft ${os} [Version ${version || "Unknown"}]`;

    document.getElementById("copyrightLine").textContent =
        "(c) Microsoft Corporation. All rights reserved.";

    document.getElementById("systemInfo").innerHTML =
        `<span>C:\\PapaLouie></span> OS: ${os} ${version} (${arch})<br>
         <span>C:\\PapaLouie></span> Browser: ${browser} ${browserVersion || ""}<br>
         <span>C:\\PapaLouie></span> Language: ${lang}`;
}

getSystemInfo();

/* ================= CONFIG ================= */

const GITHUB_USER = "ac245886";
const GITHUB_REPO = "bladlasdada";
const apiURL = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/`;

let rufflePlayer;

/* ================= LOAD SWF LIST ================= */

async function loadSWFList() {
    const select = document.getElementById("swfSelect");
    select.innerHTML = "<option>Loading...</option>";

    try {
        const response = await fetch(apiURL);
        const files = await response.json();
        const swfFiles = files.filter(f => f.name.toLowerCase().endsWith(".swf"));

        select.innerHTML = "";
        swfFiles.forEach(file => {
            const option = document.createElement("option");
            option.value = file.download_url;
            option.textContent = file.name;
            option.dataset.filename = file.name;
            select.appendChild(option);
        });
    } catch {
        select.innerHTML = "<option>Failed to load</option>";
    }
}

/* ================= RUN GAME ================= */

function runGame() {
    const select = document.getElementById("swfSelect");
    const url = select.value;
    const name = select.options[select.selectedIndex].text;

    if (!url) return;

    document.title = `C:\\PapaLouie\\${name}`;

    if (!rufflePlayer) {
        const ruffle = window.RufflePlayer.newest();
        rufflePlayer = ruffle.createPlayer();
        document.getElementById("player-container").appendChild(rufflePlayer);
    }

    rufflePlayer.load(url);
}

/* ================= DOWNLOAD SWF ================= */

document.getElementById("downloadBtn").onclick = () => {
    const select = document.getElementById("swfSelect");
    const url = select.value;
    const filename = select.options[select.selectedIndex]?.dataset.filename;

    if (!url) return;

    const a = document.createElement("a");
    a.href = url;
    a.download = filename || "game.swf";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
};

/* ================= IMPORT LOCAL SWF ================= */

document.getElementById("importBtn").onclick = () => {
    const file = document.getElementById("swfFile").files[0];
    if (!file) return;

    document.title = `C:\\PapaLouie\\${file.name}`;

    if (!rufflePlayer) {
        const ruffle = window.RufflePlayer.newest();
        rufflePlayer = ruffle.createPlayer();
        document.getElementById("player-container").appendChild(rufflePlayer);
    }

    const blobURL = URL.createObjectURL(file);
    rufflePlayer.load(blobURL);
};

document.getElementById("loadBtn").onclick = runGame;
document.addEventListener("keydown", e => {
    if (e.key === "Enter") runGame();
});

loadSWFList();
</script>

</body>
</html>
